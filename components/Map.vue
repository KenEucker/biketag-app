<script setup lang="ts">
const props = defineProps({
  center: {
    type: Object,
    default: { lat: 0, lng: 0 },
  },
  gps: {
    type: Object,
    default: { lat: 0, lng: 0 },
  },
})
const emit = defineEmits(['dragend'])
const pinIcon =
  'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRoIGQ9Ik0xMy4zMDE4IDIzLjU5MTVDMTIuODMyMyAyMy4yMjExIDEyLjMwNTMgMjIuODUwOCAxMS43MTI0IDIyLjQ3NTRDOS4xNTYyNCAyMC44NTcyIDYuODM3MzIgMTkuMzA4IDQuODE4NDYgMTcuNDc5NEMzLjIxNzA2IDE2LjAyODkgMi44OTk0NSAxNC40OTMgMS44MDYyNCAxMi45NDUxQzAuMzE4OTU5IDEwLjgzOTIgMS4wMDMzNyA5LjE1MjA5IDIuOTI2NzUgNy44MzUwMkMzLjE5MDkxIDYuNTM5MzIgNC45NzY2MyA1LjM0Mzk2IDcuMDQ5MDggNC4zMjQxOUM5LjM2NzA3IDIuNTEwNTYgMTIuNjMzMiAwLjcwNTY0NSAxNS40Njk5IDEuMDQwMzVDMTUuODM3MiAxLjA4MzY5IDE2LjE5ODUgMS4xMzEzMyAxNi41NTQxIDEuMTgzMjRDMjAuOTkyOCAwLjc4NzQ1MSAyNS4xMDI4IDIuMTk2ODQgMjguNjA1NyA0LjE4OTY2QzMyLjA3NCA2LjE2MjcyIDMwLjkyMDYgOC4zMDAwNyAzMC4zNDQ4IDEwLjY2OTdDMjkuODkyIDEyLjUzMjYgMjkuMDU4NCAxNC4zMjc3IDI3LjkzNjkgMTYuMDgwMUMyNy41MTI2IDE2Ljg0ODMgMjYuOTY5NiAxNy41ODY0IDI2LjM0NTcgMTguMzA5MkMyNS43Mzg1IDE5LjA4MjYgMjUuMDgxMyAxOS44NDk1IDI0LjM4MjQgMjAuNjEyMkMyMi43MDg4IDIyLjQzODkgMjAuNTQ4MyAyNC4xOTQyIDE5LjE3NzYgMjYuMTA0NEMxOC45MDYzIDI2Ljc1MzYgMTguNTk2NiAyNy40MDE3IDE4LjE2NjUgMjcuOTM4MUMxOC4xNDY3IDI3Ljk5MTMgMTguMTI3NyAyOC4wNDQ2IDE4LjEwOTUgMjguMDk4QzE3LjY1NyAyOS40MzA0IDE3LjE3NzEgMzAuMTI2NCAxNi45NzExIDI5LjQ5NTdDMTYuOTE3OSAyOS41ODI0IDE2Ljg2NiAyOS42Njc0IDE2LjgxNjkgMjkuNzQ4QzE2LjQ4NTQgMzAuMjkyMiAxNi4yNzczIDMwLjYzNzQgMTYuNTg3OSAyOS45NDQ3QzE2LjYzNDcgMjkuODQwMyAxNi42ODIxIDI5LjczNjYgMTYuNzMwMiAyOS42MzM0QzE1LjkxMyAyOC41MjQ3IDE1LjQ2MjQgMjcuMDgzIDE1LjE5MDUgMjYuNDQ5MkMxNC43NTA3IDI1LjQyNDQgMTQuMDE4MyAyNC41MTIxIDEzLjMwMTggMjMuNTkxNVoiIGZpbGw9IiNDNEM0QzQiLz4NCjxwYXRoIGQ9Ik0xNi44Njc0IDI4LjkyMjRDMTYuMTk3MyAyNi4zODc1IDE0LjkxNzMgMjQuNTA0MyAxMS43MTI0IDIyLjQ3NTRDOS4xNTYyNCAyMC44NTcyIDYuODM3MzIgMTkuMzA4IDQuODE4NDYgMTcuNDc5NEMzLjIxNzA2IDE2LjAyODkgMi44OTk0NSAxNC40OTMgMS44MDYyNCAxMi45NDUxQy0yLjkxMzcyIDYuMjYyMDUgMTQuMjM4NCAzLjc5NjE0IDIzLjQ1MDggMy45OTE4QzI1LjM5NzMgNC4wMzMxNCAyNi40MjQ3IDUuOTMyNTIgMjYuNjQ5MyA2LjY5NTkyQzI3LjU2MzQgOS44MDE5NyAyNy4wMjIyIDEzLjI0MyAyNC43MjQgMTYuMTI3NEMyMi43MTkyIDE4LjY0MzQgMjEuNjIwNyAyMS4zOTUxIDIwLjA5NyAyNC4wMDg5QzE5LjM3NDkgMjUuMjQ3NSAxOC45OTg3IDI3LjI2NDMgMTcuNzM2OSAyOC4zOTQ4QzE3LjMwNjEgMjguNzgwOCAxNS45OTE4IDMxLjI3NCAxNi41ODc5IDI5Ljk0NDdDMTcuODkwNyAyNy4wMzk0IDE5LjY0OTcgMjQuNjQxOCAyMi40ODgxIDIyLjA3OTdDMjUuMzQzMiAxOS41MDI2IDI4LjAxMDggMTcuMDY4IDI4LjczIDE0LjA4MjhDMjkuMjYxNSAxMS44NzYzIDMxLjkxMjEgOS4xMDQwNyAyOS41OTk1IDYuODkzNzhDMjYuMzc4NSAzLjgxNTM0IDIxLjc5OTMgMS43ODcxNiAxNS40Njk5IDEuMDQwMzVDMTEuMDgxMyAwLjUyMjUzMSA1LjY2NDc5IDUuMTI1ODMgNC4zMjE2IDYuOTU5NzNDMC45Mzg3NCAxMS41Nzg1IDYuMjk3MzEgMTYuNTYyMyAxMS40MDE5IDIwLjM4MTRDMTQuOTc3NiAyMy4wNTY3IDE2Ljg2NzQgMjUuMDkzMiAxNi44Njc0IDI4LjQ2MDhDMTYuODY3NCAzMC41MDY2IDE3LjUxMjMgMjkuODU2NSAxOC4xMDk1IDI4LjA5OEMxOS4wMzYyIDI1LjM2OTYgMjIuMTQ0NSAyMy4wNTQ3IDI0LjM4MjQgMjAuNjEyMkMyNy4zMDE5IDE3LjQyNTkgMjkuNDk0NyAxNC4xNjc0IDMwLjM0NDggMTAuNjY5N0MzMC45MjA2IDguMzAwMDcgMzIuMDc0IDYuMTYyNzIgMjguNjA1NyA0LjE4OTY2QzIzLjg1ODUgMS40ODkwMiAxNy45OTY2IC0wLjE0MDE0MSAxMS43MTI0IDIuMzQyOTVDOC40MDA3MiAzLjY1MTUzIDIuODkzMTIgNS43NDgxNCAyLjg5MzEyIDguMTYzNEMyLjg5MzEyIDExLjA4NDQgMy43OTkgMTMuMzEyNSA2LjY4MTcgMTUuODYzNUM3Ljg3NzMyIDE2LjkyMTYgOC4zNzUxMiAxOC4wMTMgOS4zNTIzMyAxOS4xMTE4QzEwLjE3ODIgMjAuMDQwNCAxMS40MDYxIDIwLjY3NjggMTEuOTYwOSAyMS42Njc1QzEyLjg4OTEgMjMuMzI1MyAxNC40NTIyIDI0LjcyODcgMTUuMTkwNSAyNi40NDkyQzE1LjYxOTIgMjcuNDQ4MiAxNi40OTE4IDMwLjQ1NTEgMTguNTQ0MyAzMSIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4NCjxwYXRoIGQ9Ik05Ljk0MjM2IDguODg4ODNDMTEuNzQ0MyA2Ljg2ODk3IDE2LjcwOTYgNi43ODc1MyAxOS4zMDI1IDguMDcwOTFDMjIuODM5MyA5LjU5NzI1IDIzLjAxOTIgMTQuMDMyNSAxNy41NTA3IDE0LjA4MjNDMTUuNDI3NiAxNC40NjI0IDEyLjgyODcgMTQuMjA1NCAxMC44MTE5IDEzLjAyNzVDOS4zNjc2NyAxMi4xODQgOC45NzYwNSAxMS4yMzg5IDkuMzAzMjkgMTAuMzczMUM5LjI5MzExIDkuODk0MzYgOS40OTE0NiA5LjM5NDI1IDkuOTQyMzYgOC44ODg4M1oiIGZpbGw9IndoaXRlIi8+DQo8cGF0aCBkPSJNMTUuNzQ5NCA5LjAzNzIzQzEzLjM0NjYgOS4zMTcyOSAxMC43MTg3IDkuNTI0NDkgMTAuNzE4NyAxMC45NDk5QzEwLjcxODcgMTIuMzUwOSAxMi40ODA3IDEzLjI3NCAxNC44Nzk5IDEzLjUwNTZDMTcuMDU1IDEzLjcxNTYgMTguMjMzMiAxMy45Mjc5IDE5Ljk3MjggMTIuODk1NUMyMS4yNjQ3IDEyLjEyODkgMjEuMTUwMyA5LjUwNzAxIDIwLjIyMTIgOC42NzQ0OEMxOC4xMzEgNi44MDE2NiAxMS45OTE0IDYuNTkxOTUgOS45NDIzNiA4Ljg4ODgzQzcuNTU5MzYgMTEuNTYgMTIuMjMwNCAxNC4wODI3IDE3LjQ1NzQgMTQuMDgyN0MyMy44MDExIDE0LjA4MjcgMjIuNzAxNCA4LjI2MjUzIDE3LjYxMjcgNy42MTkyMkMxMS44NjI4IDYuODkyMzIgNi4zNzkwNSAxMC40Mzg0IDEwLjgxMTkgMTMuMDI3NUMxNS4zNDk5IDE1LjY3NzkgMjIuODM1MyAxMy42NjU4IDIxLjIxNDkgMTAuMjI0NEMxOS40NjggNi41MTQyMSAxMS4yNzc3IDguNDI3MDkgMTEuMjc3NyAxMS40MTE2IiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPg0KPC9zdmc+DQo='
const round = (n: number) => Number(Math.round(Number(`${n}e4`)) + 'e-4')
const clean = (e: any) => {
  return {
    lat: round(e.latLng.lat()),
    lng: round(e.latLng.lng()),
  }
}
</script>

<template>
  <GMapMap :center="center" :zoom="18" map-type-id="roadmap">
    <GMapMarker
      :icon="pinIcon"
      :position="gps"
      :draggable="true"
      :clickeable="true"
      @dragend="(e : any) => emit('dragend', clean(e))"
    />
  </GMapMap>
</template>
